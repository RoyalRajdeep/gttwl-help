# Travel Agency Tribes API Documentation

# Authenticaton Routes

Login

Http Request
POST https://api2.gttwl.net/tat_api/v1/login 

| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/loginemail |   | Code will be sent to user’s email address |

Parameters
| Email | String, required, The email address of the user. |

This method accepts a users email address as its only parameter. If the user is found in The system will send an authentication code to the user's email

if the user exists in the system

`{
  content-type: "json", 
  message: "Please check your email for authentication code",  
  token: "4mmwsosbem", 
  state:"ok", 
  status: 200 
}`

Properties

The following table defines the properties that appear in the response

| Name | Description |
| ------ | ------ |
| token | String, This is a randomly generated authentication token that needs to be passed in /v1/code in order to authenticate the authentication code that was sent to the user’s email. |
| state | String, the state will be “ok” if the call was successful. If not the state will be “error” |

Error messages

``{
    content-type: "json",
    state:"error",
    message:"invalid request",
    status:400
}``



# Email Validation
POST https://api2.gttwl.net/tat_api/v1/code

| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
POST | /tat_api/v1/code | code , token | Json Map showing list of agencies the user is apart of and the user api key for each |

Parameters

| Name | Description |
| ------ | ------ |
| code | Integer, required, The 6 digit code sent to the user's email used for authentication |
| token | String, required, Random String generated by the server used in authentication, required during login to authenticate the user | 

This route accepts the authentication code sent to the user via email.

Upon successful authentication returns a "json" map with list of agencies that user is associated with:

` {
   content-type: "json",
   data:[
          {
            agency_name: "Just travel",
            apikey: "lsfw42ns",
            role: "admin",
            agency_url:"justtravel.com", 
            name:"John Mctavish"
          },.....
        ],
   state:"ok",
   Status:200
}
`


Properties
The following table defines the properties that appear in the response



| Name | Description |
| ------ | ------ |
| agency_name | String, the Name of an agency that the client is a part of |
| apikey | String, An authentication string used for requests
| role | String, This is a string dictating the role of the user in the agency, User roles are [“admin”, “agent”] |
| agency_url | String, This is the URL for the agencies website |
| name | String, This is the name of the client |

General Error :
`
{
   content-type: "json",
   state:"error",
   message:"Please contact support",
   status:400
}`  

Bad Request(missing parameters):

`
{
   content-type:"json",
   state:"error",
   message:"Missing parameters",
   status:400
}
`


# CONTENT ROUTES
 
# Get all Content(completed)
Http Request
GET https://api2.gttwl.net/tat_api/v1/contents


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/contents | apikey, page, rows, q, kind, supplier, type | List of content for that particular agency | 


Parameters

| Name | Description |
| ------ | ------ |
| apikey | String, This is the api key for the user, this must be used with all api calls |
| page | Integer, optional, This indicates the page number of results you would like to see, the default is 1. Eg, to see the 2nd page of results you would add page=2 | 
| rows | Integer, optional, This dictates the number of rows displayed per page the default is 20 if not set |
| q | String, optional, This is used to do a search on a data collection |
| kind | String, optional, used to filter by content type, content types are [ “blog”, “product”], Default is all |
| supplier | String, optional, filter content by supplier name. Leave blank to not filter by the supplier |
| type | String, optional, filter content by publish status, leave blank to not filter by status, options are [“published”, “unpublished”] |


This Route will accept the apikey for the current user for authentication, A successful request will return a json map with a list of all the content for this agency

We will use pagination in order to divide the content into pages

`
{
   content-type:"json",
   data:[
          {
            zid:"kei32s",
            title:"sample content",
            place:"New York",
            kind:"product",
            description:"some sample text",
            primary_media:"this.image/url.com",
            views:"23",
            leads:"3",
            source:"gadventures",
            created_at:"",
            permalink:"justtravel.com/sample-content"
          }....
         ],
         "pageInfo": 
           {
             total_pages: "",
             total_entries: "",
             page_size: "",
             page: "",
             next_page: "",
             more: true
           },
   state:"ok",
   status: 200
}
`

Properties
The following table defines the properties that appear in the response


| Name | Description |
| ------ | ------ |
| zid | String, Unique Identifier a piece of content |
| title | String, The Title of the content |
| place | String, The place for this content |
| kind | String, The content kind |
| description | String, The body of the content |
| primary_media | String, This is the primary image for the content |
| views | Integer, This is the view count for the content |
| leads | Integer, This is the number of leads generated by the content |
| source | String, This is the source of the content |
| created_at | Date, This is the time the content was created |
| permalink | String, This is the url to view the content on the agency’s website. |




Failed authentication :
`
{
   content-type:"json",
   state:"error",
   message: "Failed Authentication, check apikey",
   status: 401
}`

General Error :
`{
   content-type: "json",
   message: "Please try again",
   status:404
}
`


# VIEW CONTENT

Http Request
GET https://api2.gttwl.net/tat_api/v1/content


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/content | apikey, zid | Json map returning all needed fields for that post|

Parameters

| Name | Description |
| ------ | ------ |
| zid | String, optional, This is a unique identifier for an item in a collection |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |


This method returns information on a single piece of content, This route accepts the zid of the content along with the apikey for the user.


A successful call will result in a json map with all the data for the post.

`
{
 content-type:"json",
 data:
      {
        zid: "utje4",
        title:"4 Days in Osaka",
        place:"Osaka, Japan",
        kind:"product",
        views:"23",
        leads:"6",
        clicks:"130",
        source:"gadventures",
        created_at:"<<date>",
        permalink:"justtravel.com/4-days-osaka",
        description:"Come and visit osake on this 4 day",  
        attachments:[“www.url.com/image.png”......]
        activity:[
                  {
                   kind:"view",
                   title:"John Baptist wants to go to england”,
                   when:"<date>"
                  }
                 ]
      },
 state:"ok",
 status: 200
}`



Properties
The following table defines the properties that appear in the response



| Name | Description |
| ------ | ------ |
| zid | String, The unique Identifier for the content. |
| title | String, The title of the content |
| place | String, The place for the content |
| kind | String, The kind of the content |
| views | Integer, The number of views for the content |
| leads | Integer, The number of leads generated from the content |
| clicks | Integer, The number of clicks for on the content |
| source | String, The source of the content |
| created_at | Date, The date created |
| permalink | String, The url for the content |
| description | String, The body of the content |
| primary_media | String, The url for the primary image |
| activity[kind] | String, The kind for the activity |
| activity[name] | String, The title for the activity |
| activity[when] | String, When the activity was created |


No content found: 

`{
  content-type:"json",
  state:"error",
  message: "Sorry, Nothing found",
  status: 404
}`


Failed authentication :

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`


# Unpublish/Publish Content

Http Request(completed)
POST https://api2.gttwl.net/tat_api/v1/content/unpublish


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/content/publish | apikey, zid, action | Content will be published or unpublished from the agency |


Parameters

| Name | Description |
| ------ | ------ |
| zid | String, optional, This is a unique identifier for an item in a collection |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |
| action | String, required, used to define an action to take, accepted actions are [pub, unpub], used when publishing/unpublishing products |


This route will unpublish a particular piece of content from the agency site, this route accepts zid of the content to be unpublished, along with the apikey and an action. A successful call will return a json map with a message confirming that the content has been unpublished. 


post unpublushed

`{
   content-type: "json",
   state:"ok",
   message: "Post successfully unpublished",
   status:200
}`

post published

`{
   content-type: "json",
   state:"ok",
   message: "Post successfully published",
   status:200
}`

already published

`{
   content-type: "json",
   state:"ok",
   message: "Post already published",
   status:200
}`


already unpublished

`{
   content-type: "json",
   state:"ok",
   message: "Post already unpublished",
   status:200
}`


No content found: 

`{
   content-type:"json",
   state:"error",
   message: "Sorry, post not found",
   status: 200
}`

Failed Authentication Error:

`{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`


# Create Content

Http Request
POST https://api2.gttwl.net/tat_api/v1/content


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/content | apikey, title, place, category, facebook, twitter, to_newsletter, schedule, expiration_date, description, media | Content is created and returned back |


Parameters


| Name | Description |
| ------ | ------ |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |
| title | String, required, The title of the content, if left blank api will not save the post. |
| place | String, optional, name of a place or location Eg place=Paris |
| category | String, optional, Category of post [ Before your trip, Business, Dining, Escorted or Guided Tour, Local Events, Nightlife, Outdoor Activities, Rest & Relaxation, River or Ocean Cruises, Shopping, Sightseeing, Transportation, Hotels, Adventure, Culture & History, All Inclusive, Sea & Sand, Sports, Wellness, Spiritual, Luxury, Cultural Exchanges,Awesome Travel Stuff, Live, Golf] |
| facebook | Boolean, optional, Post to Facebook |
| twitter | Boolean, optional, Post to Twitter |
| to_newsletter | Boolean, optional, Add to newsletter |
| expiration_date | Date, optional, Expiry date of a piece of content must be in format YYYY-MM-DD |
| description  | String, optional, text body of content |
| media | File, Images to add to the content. |
| kind | String, required, the kind of the post [product, blog] if not specified default will be product |


This route accepts all the fields needed for the supplier content creation. And returns the post after creation


`{
   content-type:"json",
   data:{
         zid: "",
         title:"",
         place:"",
         kind:"",
         views:"",
         leads:"",
         clicks:"",
         source:"",
         created_at:"",
         permalink:"",
         description:"",
         primary_media:"",
         activity:[
                   {
                     kind:"",
                     username:"",
                     kind:"",
                     when:""
                   }
                  ]
        },
   state:"ok",
   status: 200
}`



Failed Authentication Error: 

`{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

Returns error :

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`

# GET ALL CUSTOMERS

Http Request
GET https://api2.gttwl.net/tat_api/v1/customers



| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/customers | apikey, q, page, rows | List of customers belonging to that agency |




Parameters

| Name | Description |
| ------ | ------ |
| apikey | String, This is the api key for the user, this must be used with all api calls
| page | Integer, optional, This indicates the page number of results you would like to see, the default is 1 Eg, to see the 2nd page of results you would add page=2|
| rows | Integer, optional, This dictates the number of rows displayed per page the default is 20 if not set | 
| q | String, optional, This is used to do a search on a data collection |



This route returns a json map with a list of all the content in for that agency.

`{
   content-type:"json",
   data:
        [
          {
           zid: "iem424",
           name:"John Baptist",
           place:"Nurburg, Germany",
           created_at:""
          }....
        ],
   "pageInfo": 
           {
             total_pages: "",
             total_entries: "",
             page_size: "",
             page: "",
             next_page: "",
             more: true
           },
   state:"ok",
   status: 200
}`

Properties
The following table defines the properties that appear in the response

| Name | Description |
| ------ | ------ |
| zid | String, Unique Identifier for a customer | 
| name | String, Customer name |
| place | String, Place associated with the customer |
| created_at | Date, When the customer was created |


Failed authentication: 
`
{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

General error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`



# VIEW CUSTOMER

Http Request
GET https://api2.gttwl.net/tat_api/v1/customer


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/customer | apikey, zid | Json map returning customer information for this user |

Parameters


| Name | Description |
| ------ | ------ |
| zid | String, required, This is a unique identifier for an item in a collection | 
| apikey | String, required, This is the api key for the user, this must be used with all api calls |


`{
   content-type:"json",
   user:{
          zid: "",
          name:"",
          place:"Nurburg, Germany",
          email:"jbaptist@example.com",
          phone:"876-482-7749",
          visit:"54",
          leads:"4",
          click_rate:"24",
          open_rate:"23",
          source:"",
          created_at:"<date>",
          picture:"",
         },
   subscribed:{
                subscribed:"true"
                when:"<date>",
                email_suppressed:"<email not blocked"
              },
   activity:[
             {
               kind:"open",
               name:"John Baptist",
               when:"<date>"
             }....
            ],
   state:"ok",
   status: 200
}`

Properties
The following table defines the properties that appear in the response


| Name | Description |
| ------ | ------ |
| zid | String, Unique Identifier for user |
| name | String, Name of user |
| place | String, Place associated with the user |
| email | String, users email address |
| phone | String, User phone number |
| visit | Integer, The number of visits for this user |
| leads | Integer, The number of leads for this user |
| click-rate | Integer, The percentage email click rate for this user |
| open-rate | Integer, The percentage email open rate for this user |
| source | String, The user source |
| created_at | Date, the date the user was created |
| subscribed | Map, This map contains the user's subscription status, this contains a boolean field stating if the user is subscribed to newsletters or not, When they subscribed or unsubscribed and if their email is in the suppressed list |
| activity | Map, This map contains a recent list of activities for the user, this includes the activity kind, the name associated with the activity and when this interaction took place, returns an empty list if no activity is found. |
| picture | This is the url of the users profile picture, will be “” if no profile picture is found. |


Failed authentication error :

`
{
  content-type:"json",
  state:"error",
  message:"Failed Authentication",
  status: 401
}`

General error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:400
}`

User not found error:

`{
   content-type:"json",
   state:"error",
   message:"user not found",
   status: 404
}`

# CREATE CUSTOMER

Http Request 
POST https://api2.gttwl.net/tat_api/v1/customer


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/customer | apikey, name, email, phone, newsletter, interests, place, start date, end date, notes
| Creates customer |


Parameters

| Name | Description |
| ------ | ------ |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |
| email | String, required, The email address of the user. |
| name | String, required, The name of an agent in the system |
| phone | String, optional, The phone number of an agent in the system |
| newsletter | Boolean, optional, True to allow user to receive newsletters False to not default will be set for true for each user if not set |
| interests | String, optional, comma separated string listing interests/tags for a user |
| place  | String, optional, name of a place or location Eg place=Paris |
| startdate | Date, optional, start date for a piece of content or lead, accepts iso8601 date format “YYYY-MM-DD” |
| enddate | Date, optional, end date for a piece of content or lead, accepts iso8601 date format “YYYY-MM-DD” |
| notes | String, optional, text body of lead, this is required if the user wants to submit a lead along with addig the customer, if notes field is left blank start date and end date will be ignored and a lead will not be added. |




This route accepts all the required fields to add a user to the system.

`{
   content-type: "json",
   state:”ok”,
   message: "User successfully added",
   status:200
}`



Failed authentication error : 

`{
   content-type:"json",
   state:”error”,
   message: "Failed Authentication",
   status: 401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:400
}`


# VIEW ALL ACTIVITY

Http Request
https://api2.gttwl.net/tat_api/v1/activities


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/activities | apikey, kind, row, page | List of recent actions for this agency |

Parameters

| Name | Description |
| ------ | ------ |
| apikey | String, This is the api key for the user, this must be used with all api calls
| page | Integer, optional, This indicates the page number of results you would like to see, the default is 1 Eg, to see the 2nd page of results you would add page=2 | 
| rows | Integer, optional, This dictates the number of rows displayed per page the default is 20 if not set |
| kind | String, optional, used to filter by activity type, Activity kinds are [“click”, “view”, “open”, “lead”] The default is all if not passed |



Route works similarly to /content and /customers route. 

`{
   content-type: "json",
   activities:[
                {
                  zid: "ty5h3w",
                  title:"4 days in osaka",
                  user: "John Baptist",
                  created_at:"<date>",
                  kind:"view"
                }...
              ],
   "pageInfo": 
           {
             total_pages: "",
             total_entries: "",
             page_size: "",
             page: "",
             next_page: "",
             more: true
           },
   state:"ok",
   status: 200
}`


Properties
The following table defines the properties that appear in the response


| Name | Description |
| ------ | ------ |
| zid | String, unique Identifier for the activity |
| title | String, The title of the activity |
| user | String, The user’s name that associated with the activity |
| created_at | Date, The time this interaction happened |
| kind | String, The activity kind |


Failed authentication : 
`{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`


# VIEW ACTIVITY

Http Request
https://api2.gttwl.net/tat_api/v1/activity




| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/activity | apikey, zid | Json map showing the details for that specific activity |


Parameters

| Name | Description |
| ------ | ------ |
| zid | String, required, This is a unique identifier for an item in a collection | 
| apikey | String, required, This is the api key for the user, this must be used with all api calls |




This route returns the data for an activity

`{
   content-type:"json",
   activity:{
              zid: "ryj35",
              title:"4 Days in Osaka",
              kind:"view"
            }, 
   user:{
          zid:"rusmpe3",
          name:"John baptist",
          email:"jbaptist@example.com",
          phone:"876-493-4420",
          place:"Nurburg, Germany",
          agent:"Andrew Hylton"},
   post:{
          zid: "7syrjw",
          title:"4 Days in Osaka",
          source:"gadventures",
          place:"Osaka, Japan",
          primary_image: "image-url.com"
          leads:"23",
          views:"53"
        },
   state:"ok",
   status: 200
}`

Properties
The following table defines the properties that appear in the response


| Name | Description |
| ------ | ------ |
| activity[zid] | String, Unique Identifier for the activity |
| activity[title] | String, The title for the activity |
| activity[kind] | String, The activity kind |
| user[] | This contains all the information for the user associated with this activity if no user is attached to the activity endpoint returns an empty list |
| post[] | This contains all the information for the content associated with this activity
pos is attached to the activity endpoint returns an empty list |



No activity found: 
`
{
   content-type:"json",
   state:"error",
   message: "Sorry, Activity not found",
   status: 404
}`

Failed Authentication Error: 

`{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:400
}`



# SETTINGS ROUTES

Http Request
https://api2.gttwl.net/tat_api/v1/settings


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/settings | apikey | Json map with with the current settings of the user |



Parameters


| Name | Description |
| ------ | ------ |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |


This route returns the current user information and the current settings for the user


`{
   content-type:"json",
   user:{
          zid:"iroshr",
          name: "Stacy Jones",
          email:"jbaptist@example.com",
          phone:"876-435-4432",
          title:"Travel Consultant",
          bio:"I'll help you get where you want to go",
          place:"Calgry, Canada",
          photo_url: "amazons3.com/profile/picture"
         },
   settings:{
              noleadnotif:"true",
              hideprofile:"false"
            },
   state:"ok",
   status:200
}`


Properties
The following table defines the properties that appear in the response


| Name | Description |
| ------ | ------ |
| user[zid] | String, The Unique identifier for the user |
| user[name] | String, The name of the user |
| user[email] | String, The users email address |
| user[phone] | String, The user’s telephone number |
| user[title] | String, The user’s title |
| user[bio] | String, The user’s bio |
| user[place] | String, The place associated with the user |
| settings[noleadnotif] | Boolean, Set to true if user should receive lead notifications, false if not | 
| settings[hideprofile] | Boolean, Set to true to not show the agents profile in the agents directory on the agency site. |



Failed Authentication Error: 

`{
   content-type:"json",
   state:”error”,
   message: "Failed Authentication",
   status: 401
}`

General error : 

`{
   content-type: "json",
   state:”error”,
   message: "Please try again",
   status:404
}`



# UPDATE SETTINGS

Http Request
https://api2.gttwl.net/tat_api/v1/settings


| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/settings | apikey, email, hideprofile, name, phone, title, bio, photo, leadnotif | Updates user settings and or info |


Parameters



| Name | Description |
| ------ | ------ |
| apikey | String, requred,This is the api key for the user, this must be used with all api calls |
| email | String, required(user will have one in order to be logged in. cannot be changed to blank), The email address of the user. |
| hideprofile | Boolean, optional,  Hides user profile from agency directory, default is set to false if not set. |
| name | String, optional(assuming name a name is already set, cannot be set to blank), The name of an agent in the system |
| phone | String, optional, The phone number of an agent in the system |
| title | String, optional, The title of the user |
| photo | File, the photo of the user, |
| noleadnotif | Boolean, optional, This dictates if this user will receive lead notifications |




This route allows for updating the user's information and settings.
`{
   content-type: "json",
   state:"ok",
   message: "Successfully updated user settings",
   status:200
}`

Else

Failed Authentication Error: 

`{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:400
}`




