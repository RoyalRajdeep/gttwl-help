# Travel Agency Tribes API Documentation

# Authenticaton Routes

Login

Http Request
POST https://api2.gttwl.net/tat_api/v1/login 

| Method | Route | Parameters | Result |
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/loginemail |   | Code will be sent to user’s email address |

Parameters
| Email | String, required, The email address of the user. |

This method accepts a users email address as its only parameter. If the user is found in The system will send an authentication code to the user's email

if the user exists in the system

`{
  content-type: "json", 
  message: "Please check your email for authentication code",  
  token: "4mmwsosbem", 
  state:"ok", 
  status: 200 
}`

Properties

The following table defines the properties that appear in the response

| Name | Description |
| ------ | ------ |
| token | String, This is a randomly generated authentication token that needs to be passed in /v1/code in order to authenticate the authentication code that was sent to the user’s email. |
| state | String, the state will be “ok” if the call was successful. If not the state will be “error” |

Error messages

``{
    content-type: "json",
    state:"error",
    message:"invalid request",
    status:400
}``



# Email Validation
POST https://api2.gttwl.net/tat_api/v1/code

| Method | Route | Parameters | Result
| ------ | ------ | ------ | ------ |
POST | /tat_api/v1/code | code , token | Json Map showing list of agencies the user is apart of and the user api key for each |

Parameters

| Name | Description |
| ------ | ------ |
| code | Integer, required, The 6 digit code sent to the user's email used for authentication |
| token | String, required, Random String generated by the server used in authentication, required during login to authenticate the user | 

This route accepts the authentication code sent to the user via email.

Upon successful authentication returns a "json" map with list of agencies that user is associated with:

` {
   content-type: "json",
   data:[
          {
            agency_name: "Just travel",
            apikey: "lsfw42ns",
            role: "admin",
            agency_url:"justtravel.com", 
            name:"John Mctavish"
          },.....
        ],
   state:"ok",
   Status:200
}
`


Properties
The following table defines the properties that appear in the response



| Name | Description |
| ------ | ------ |
| agency_name | String, the Name of an agency that the client is a part of |
| apikey | String, An authentication string used for requests
| role | String, This is a string dictating the role of the user in the agency, User roles are [“admin”, “agent”] |
| agency_url | String, This is the URL for the agencies website |
| name | String, This is the name of the client |

General Error :
`
{
   content-type: "json",
   state:"error",
   message:"Please contact support",
   status:400
}`  

Bad Request(missing parameters):

`
{
   content-type:"json",
   state:"error",
   message:"Missing parameters",
   status:400
}
`


# CONTENT ROUTES
Get all Content(completed)
Http Request
GET https://api2.gttwl.net/tat_api/v1/contents


| Method | Route | Parameters | Result
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/contents | apikey, page, rows, q, kind, supplier, type | List of content for that particular agency | 


Parameters
| Name | Description |
| ------ | ------ |
| apikey | String, This is the api key for the user, this must be used with all api calls |
| page | Integer, optional, This indicates the page number of results you would like to see, the default is 1. Eg, to see the 2nd page of results you would add page=2 | 
| rows | Integer, optional, This dictates the number of rows displayed per page the default is 20 if not set |
| q | String, optional, This is used to do a search on a data collection |
| kind | String, optional, used to filter by content type, content types are [ “blog”, “product”], Default is all |
| supplier | String, optional, filter content by supplier name. Leave blank to not filter by the supplier |
| type | String, optional, filter content by publish status, leave blank to not filter by status, options are [“published”, “unpublished”] |


This Route will accept the apikey for the current user for authentication, A successful request will return a json map with a list of all the content for this agency

We will use pagination in order to divide the content into pages

`
{
   content-type:"json",
   data:[
          {
            zid:"kei32s",
            title:"sample content",
            place:"New York",
            kind:"product",
            description:"some sample text",
            primary_media:"this.image/url.com",
            views:"23",
            leads:"3",
            source:"gadventures",
            created_at:"",
            permalink:"justtravel.com/sample-content"
          }....
         ],
         "pageInfo": 
           {
             total_pages: "",
             total_entries: "",
             page_size: "",
             page: "",
             next_page: "",
             more: true
           },
   state:"ok",
   status: 200
}
`

Properties
The following table defines the properties that appear in the response


| Name | Description |
| ------ | ------ |
| zid | String, Unique Identifier a piece of content |
| title | String, The Title of the content |
| place | String, The place for this content |
| kind | String, The content kind |
| description | String, The body of the content |
| primary_media | String, This is the primary image for the content |
| views | Integer, This is the view count for the content |
| leads | Integer, This is the number of leads generated by the content |
| source | String, This is the source of the content |
| created_at | Date, This is the time the content was created |
| permalink | String, This is the url to view the content on the agency’s website. |




Failed authentication :
`
{
   content-type:"json",
   state:"error",
   message: "Failed Authentication, check apikey",
   status: 401
}`

General Error :
`{
   content-type: "json",
   message: "Please try again",
   status:404
}
`


# VIEW CONTENT

Http Request
GET https://api2.gttwl.net/tat_api/v1/content


| Method | Route | Parameters | Result
| ------ | ------ | ------ | ------ |
| GET | /tat_api/v1/content | apikey, zid | Json map returning all needed fields for that post|

Parameters

| Name | Description |
| ------ | ------ |
| zid | String, optional, This is a unique identifier for an item in a collection |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |


This method returns information on a single piece of content, This route accepts the zid of the content along with the apikey for the user.


A successful call will result in a json map with all the data for the post.

`
{
 content-type:"json",
 data:
      {
        zid: "utje4",
        title:"4 Days in Osaka",
        place:"Osaka, Japan",
        kind:"product",
        views:"23",
        leads:"6",
        clicks:"130",
        source:"gadventures",
        created_at:"<<date>",
        permalink:"justtravel.com/4-days-osaka",
        description:"Come and visit osake on this 4 day",  
        attachments:[“www.url.com/image.png”......]
        activity:[
                  {
                   kind:"view",
                   title:"John Baptist wants to go to england”,
                   when:"<date>"
                  }
                 ]
      },
 state:"ok",
 status: 200
}`



Properties
The following table defines the properties that appear in the response



| Name | Description |
| ------ | ------ |
| zid | String, The unique Identifier for the content. |
| title | String, The title of the content |
| place | String, The place for the content |
| kind | String, The kind of the content |
| views | Integer, The number of views for the content |
| leads | Integer, The number of leads generated from the content |
| clicks | Integer, The number of clicks for on the content |
| source | String, The source of the content |
| created_at | Date, The date created |
| permalink | String, The url for the content |
| description | String, The body of the content |
| primary_media | String, The url for the primary image |
| activity[kind] | String, The kind for the activity |
| activity[name] | String, The title for the activity |
| activity[when] | String, When the activity was created |


No content found: 

`{
  content-type:"json",
  state:"error",
  message: "Sorry, Nothing found",
  status: 404
}`


Failed authentication :

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`


# Unpublish/Publish Content

Http Request(completed)
POST https://api2.gttwl.net/tat_api/v1/content/unpublish


| Method | Route | Parameters | Result
| ------ | ------ | ------ | ------ |
| POST | /tat_api/v1/content/publish | apikey, zid, action | Content will be published or unpublished from the agency |


Parameters

| Name | Description |
| ------ | ------ |
| zid | String, optional, This is a unique identifier for an item in a collection |
| apikey | String, required, This is the api key for the user, this must be used with all api calls |
| action | String, required, used to define an action to take, accepted actions are [pub, unpub], used when publishing/unpublishing products |


This route will unpublish a particular piece of content from the agency site, this route accepts zid of the content to be unpublished, along with the apikey and an action. A successful call will return a json map with a message confirming that the content has been unpublished. 


post unpublushed

`{
   content-type: "json",
   state:"ok",
   message: "Post successfully unpublished",
   status:200
}`

post published

`{
   content-type: "json",
   state:"ok",
   message: "Post successfully published",
   status:200
}`

already published

`{
   content-type: "json",
   state:"ok",
   message: "Post already published",
   status:200
}`


already unpublished

`{
   content-type: "json",
   state:"ok",
   message: "Post already unpublished",
   status:200
}`


No content found: 

`{
   content-type:"json",
   state:"error",
   message: "Sorry, post not found",
   status: 200
}`

Failed Authentication Error:

`{
   content-type:"json",
   state:"error",
   message: "Failed Authentication",
   status: 401
}`

Returns error : 

`{
   content-type: "json",
   state:"error",
   message: "Please try again",
   status:404
}`

